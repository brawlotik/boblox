local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local RootPart = Character:WaitForChild("HumanoidRootPart")

local teleportSpeed = 10
local reachedTarget = false

local function getTeleportTarget()
    local targetObject = workspace:FindFirstChild("Rob_Alarm")
    if targetObject then
        targetObject = targetObject:FindFirstChild("Robberys")
    end
    if targetObject then
        targetObject = targetObject:FindFirstChild("Jeweler")
    end

    if targetObject then
        for _, child in ipairs(targetObject:GetChildren()) do
            local itemHolder = child:FindFirstChild("ItemHolder")
            if itemHolder and #itemHolder:GetChildren() > 0 then
                return itemHolder, itemHolder:GetChildren()[1].Position -- Берем первый объект и сам ItemHolder
            end
        end
    end
    return nil, nil
end

local function smoothTeleport(target)
    if not RootPart then return end

    local distance = (RootPart.Position - target).Magnitude
    local duration = distance / teleportSpeed
    local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Linear)
    local tween = TweenService:Create(RootPart, tweenInfo, {CFrame = CFrame.new(target)})

    tween:Play()
    tween.Completed:Wait()

    if (RootPart.Position - target).Magnitude < 1 then
        reachedTarget = true
        print("Телепортация завершена.")
    end
end

local function pressF()
    for i = 1, 5 do
        VirtualInputManager:SendKeyEvent(true, "F", false, game)
        task.wait(0.1)
        VirtualInputManager:SendKeyEvent(false, "F", false, game)
        print("Клавиша F нажата " .. i .. " раз")
        task.wait(0.2) -- Задержка между нажатиями
    end
end

local function holdE(itemHolder)
    if itemHolder and #itemHolder:GetChildren() > 0 then
        VirtualInputManager:SendKeyEvent(true, "E", true, game)
        print("Клавиша E зажата")
        task.wait(5) -- Удерживаем E 5 секунд
        VirtualInputManager:SendKeyEvent(false, "E", false, game)
        print("Клавиша E отпущена")
    else
        print("ItemHolder пуст, не зажимаем E.")
    end
end

local function startTeleportLoop()
    while not reachedTarget do
        local itemHolder, target = getTeleportTarget()
        if target then
            smoothTeleport(target)
            pressF() -- Нажимаем "F" 5 раз после телепорта
            task.wait(1) -- Ждем перед зажатием "E"
            holdE(itemHolder) -- Зажимаем "E" только если в ItemHolder есть объекты
        else
            warn("ItemHolder пуст или отсутствует. Останавливаем телепортацию.")
            break
        end
        wait(1) -- Ждем перед следующим поиском
    end
end

task.spawn(startTeleportLoop)
